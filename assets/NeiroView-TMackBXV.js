import{r as d,u as L,o as B,w as D,c as u,a,b as v,F as M,d as N,e as O,f as _,g as h,v as f,h as j,n as I,i as c,j as P}from"./index-BuKrKZep.js";const U={class:"chat-section"},H={class:"chat-wrapper"},J={class:"message-content"},$={key:0,class:"user-label"},E={key:1,class:"ai-label"},F=["innerHTML"],K=["onClick"],q={key:0,class:"chat-message ai"},R=["disabled","onKeydown"],W=["disabled"],Z=["disabled"],G={class:"popup"},Y={__name:"NeiroView",setup(Q){const n=d(""),s=d([]),i=d(!1),y=d(null),m=L();B(()=>{const l=localStorage.getItem("neiro_chat_history");l&&(s.value=JSON.parse(l))}),D(s,l=>{localStorage.setItem("neiro_chat_history",JSON.stringify(l))},{deep:!0});function p(){I(()=>{y.value&&(y.value.scrollTop=y.value.scrollHeight)})}async function k(){if(!n.value.trim())return;const l={role:"user",text:n.value};s.value.push(l);const t=n.value;n.value="",i.value=!0,p();try{const e=await fetch("https://tourgid-production.up.railway.app/api/ask",{method:"POST",headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"application/json"},body:JSON.stringify({question:t})});if(!e.ok)throw new Error("Ошибка API");const o=await e.json();await x(o.answer)}catch(e){console.error(e),s.value.push({role:"ai",text:"Ошибка получения ответа."})}finally{i.value=!1,p()}}async function S(){if(!n.value.trim())return;const l={role:"user",text:n.value};s.value.push(l);const t=n.value;n.value="",i.value=!0,p();try{const e=await fetch("https://tourgid-production.up.railway.app/api/generate_route",{method:"POST",headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!e.ok)throw new Error("Ошибка API");const o=await e.json();console.log(o),typeof o.description=="string"&&o.description.length>0?await x(o.description,o.points):s.value.push({role:"ai",text:"Нет данных о маршруте."})}catch(e){console.error(e),s.value.push({role:"ai",text:"Ошибка получения маршрута."})}finally{i.value=!1,p()}}async function x(l,t=null){if(typeof l!="string"||!l.length)return;let e="";for(let o=0;o<l.length;o++)e+=l[o],o===0&&s.value.push({role:"ai",text:"",points:t}),s.value[s.value.length-1].text=e,await new Promise(T=>setTimeout(T,18+Math.random()*30)),p()}function V(l){let t=l.replace(/\*\*(.+?)\*\*/g,"<b>$1</b>");return t=t.replace(/\n/g,"<br>"),t}const g=d(!1),r=d({destination:"",startDate:"",endDate:"",notes:"",points:[]});let w=null;function z(l){g.value=!0,r.value={destination:"",startDate:"",endDate:"",notes:"",points:l.points||[]},w=s.value.indexOf(l)}function b(){g.value=!1,w=null}async function A(){try{if(!(await fetch("https://tourgid-production.up.railway.app/profile/trips",{method:"POST",headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"application/json"},body:JSON.stringify(r.value)})).ok)throw new Error("Ошибка добавления маршрута");w!==null&&(s.value[w].added=!0),b(),alert("Маршрут успешно добавлен в профиль!")}catch(l){alert("Ошибка при добавлении маршрута"),console.error(l)}}function C(){s.value=[],localStorage.removeItem("neiro_chat_history")}return(l,t)=>(c(),u(M,null,[a("section",U,[a("div",H,[t[8]||(t[8]=a("div",{class:"chat-header"},[a("h2",null,"Чат с нейросетью")],-1)),a("div",{class:"chat-history",ref_key:"chatHistory",ref:y},[(c(!0),u(M,null,N(s.value,(e,o)=>(c(),u("div",{key:o,class:P(["chat-message",e.role])},[a("div",J,[e.role==="user"?(c(),u("span",$,"Вы:")):v("",!0),e.role==="ai"?(c(),u("span",E,"Нейросеть:")):v("",!0),a("span",{innerHTML:V(e.text)},null,8,F),e.role==="ai"&&e.points&&!e.added?(c(),u("button",{key:2,class:"add-trip-btn",onClick:T=>z(e)}," Добавить маршрут ",8,K)):v("",!0)])],2))),128)),i.value?(c(),u("div",q,t[5]||(t[5]=[O('<div class="message-content"><span class="ai-label">Нейросеть:</span><span class="typing-indicator"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span></div>',1)]))):v("",!0)],512),a("form",{class:"chat-input",onSubmit:_(k,["prevent"])},[h(a("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),type:"text",placeholder:"Введите сообщение...",disabled:i.value,onKeydown:j(_(k,["exact","prevent"]),["enter"])},null,40,R),[[f,n.value]]),a("button",{disabled:!n.value.trim()||i.value},t[6]||(t[6]=[a("span",{class:"chat-input__icon"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",viewBox:"0 0 512 512",fill:"#000000"},[a("path",{fill:"#000000",d:"m476.59 227.05l-.16-.07L49.35 49.84A23.56 23.56 0 0 0 27.14 52A24.65 24.65 0 0 0 16 72.59v113.29a24 24 0 0 0 19.52 23.57l232.93 43.07a4 4 0 0 1 0 7.86L35.53 303.45A24 24 0 0 0 16 327v113.31A23.57 23.57 0 0 0 26.59 460a23.94 23.94 0 0 0 13.22 4a24.55 24.55 0 0 0 9.52-1.93L476.4 285.94l.19-.09a32 32 0 0 0 0-58.8Z"})])],-1),a("span",{class:"chat-input__text"}," Отправить ",-1)]),8,W),a("button",{type:"button",class:"route-btn",disabled:!n.value.trim()||i.value,onClick:S},t[7]||(t[7]=[a("span",{class:"chat-input__icon"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",viewBox:"0 0 28 24",fill:"#000000"},[a("path",{fill:"#000000",d:"m26.602 23.85l-6.066-4.073l-6.073 4.073c-.132.091-.295.145-.472.145s-.34-.054-.474-.147l.003.002l-6.068-4.073l-6.067 4.073a.836.836 0 0 1-.928.011l.003.002a1.06 1.06 0 0 1-.46-.874v-.021v.001V5.393c0-.352.173-.663.439-.853l.003-.002L6.983.146c.132-.091.295-.145.472-.145s.34.054.474.147L7.926.146l6.066 4.073L20.059.146c.132-.091.295-.145.472-.145s.34.054.474.147l-.003-.002l6.541 4.392c.266.189.438.497.438.844l-.001.038v-.002v17.581c0 .361-.182.679-.459.869l-.004.002a.83.83 0 0 1-.45.131a.863.863 0 0 1-.472-.152l.003.002zM2 6.056v15.101l4.436-3.086V2.97zm12.993 15.045l4.56-3.062v-6.823c-.044.044-.08.087-.118.131c-.113.131-.225.262-.338.387l-.75-.662c.106-.125.218-.25.331-.381c.175-.194.35-.4.538-.606l.331.3V2.938L14.986 6v7.017a4.11 4.11 0 0 0 .435-.047l-.023.003l.16.987a6.7 6.7 0 0 1-.531.056h-.031zm-6.56-3.055l4.56 3.055V12.96l-.262.8a5.654 5.654 0 0 1-1.316-.625l.022.013l.531-.85c.295.191.633.358.991.483l.034.01V5.999l-4.56-3.061v6.304c.296.157.545.312.783.483l-.02-.014l-.581.812c-.056-.044-.118-.08-.181-.125zM22.246 9.28a3.579 3.579 0 0 0-.716.234l.023-.009v8.575l4.429 3.02V5.994l-4.436-3.033v5.467c.129-.044.297-.089.468-.125l.032-.006zm-5.735 3.348c.37-.184.689-.405.972-.665l-.003.003l.662.75a5.166 5.166 0 0 1-1.164.798l-.03.014zm-6.923-1.124c-.056-.075-.118-.144-.181-.218l.762-.65l.187.225c.218.256.418.5.64.72l-.687.725a9.551 9.551 0 0 1-.711-.782l-.014-.018zm-6.379.24l.013-.05c.136-.487.333-.912.586-1.297l-.011.017l.825.56c-.188.295-.34.636-.438 1L4.178 12l-.018.056zM24.114 9.7l-.64.65l-.712-.712l.65-.64l-.65-.64l.712-.712l.64.65l.64-.65l.712.712l-.65.64l.65.64l-.712.712zM4.497 9.53a3.54 3.54 0 0 1 .689-.509l.018-.009c.169-.093.368-.18.574-.249l.025-.007l.306.95c-.15.044.075.038-.062.113c-.334.132-.62.281-.888.456l.019-.012z"})])],-1),a("span",{class:"chat-input__text"}," Построить маршрут ",-1)]),8,Z)],32),a("div",{class:"clear-btn__wrapper"},[a("button",{class:"clear-chat-btn",onClick:C},"Очистить чат")])])]),g.value?(c(),u("div",{key:0,class:"popup-backdrop",onClick:_(b,["self"])},[a("div",G,[t[9]||(t[9]=a("h3",null,"Добавить маршрут",-1)),h(a("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.destination=e),placeholder:"Название маршрута (например, Южный берег Крыма)"},null,512),[[f,r.value.destination]]),h(a("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.value.startDate=e),type:"date",placeholder:"Дата начала"},null,512),[[f,r.value.startDate]]),h(a("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.value.endDate=e),type:"date",placeholder:"Дата окончания"},null,512),[[f,r.value.endDate]]),h(a("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.notes=e),placeholder:"Заметки"},null,512),[[f,r.value.notes]]),a("button",{onClick:A,class:"upload-btn"},"Сохранить"),a("button",{onClick:b,class:"cancel-btn"},"Отмена")])])):v("",!0)],64))}};export{Y as default};
