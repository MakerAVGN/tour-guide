import{u as I,r as k,k as B,w as j,l as H,o as Y,c,b as _,m as o,a as t,t as v,p as J,q as F,F as L,d as O,g as w,v as T,s as q,e as G,x as W,y as X,f as Z,i as p,j as K}from"./index-37wVl6QS.js";const Q="https://tourgid-production.up.railway.app",z={POST:"POST",PUT:"PUT",DELETE:"DELETE"},ee={JSON:"application/json"},$=5*1024*1024,S=async(i,l={})=>{var a;const{token:n,...d}=l;if(d.body&&(d.body instanceof FormData?((a=d.body.get("photo"))==null?void 0:a.size)||0:JSON.stringify(d.body).length)>$)throw new Error(`–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π (${$/1024/1024}MB)`);const r=await fetch(`${Q}${i}`,{...d,headers:{...d.headers,...n&&{Authorization:`Bearer ${n}`}}});if(!r.ok){const h=await r.text();throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${r.status} - ${h}`)}return r.json()},U={async getProfile(i){return S("/profile",{token:i})},async updateProfile(i,l){const n={username:l.username,email:l.email,name:l.name,surname:l.surname,phone:l.phone,gender:l.gender,birthday:l.birthday};return S("/profile",{method:z.PUT,headers:{"Content-Type":ee.JSON},body:JSON.stringify(n),token:i})},async uploadPhoto(i,l){if(l.size>$)throw new Error(`–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π (${$/1024/1024}MB)`);const n=new FormData;return n.append("photo",l),S("/profile/upload-photo",{method:z.POST,body:n,token:i})},async getPhoto(i){return S("/profile/photo",{token:i})},async deleteTrip(i,l){return S(`/profile/trips/${l}`,{method:z.DELETE,token:i})}};function te(){const i=H(),l=I(),n=k(!1),d=k({username:"",email:"",name:"",surname:"",phone:"",gender:"",birthday:"",photo:null}),r=k("/tour-guide/img/user-default.jpg"),a=k(!1),h=k("profile"),m=[{id:"profile",label:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ"},{id:"history",label:"–ú–æ–∏ —Ç—É—Ä—ã"},{id:"security",label:"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"}],b=B(()=>{const u=m.find(f=>f.id===h.value);return u?u.label:""}),N=async()=>{if(!l.isAuth){i.push("/");return}n.value=!1;try{await l.fetchProfile(),l.user&&(d.value={...l.user})}catch(u){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",u)}finally{n.value=!0}},E=async()=>{try{const u=await U.updateProfile(l.token,d.value);return l.user=u,{success:!0,message:"–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!"}}catch(u){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",u),{success:!1,message:u.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è"}}},C=()=>{l.logout(),i.push("/")},A=()=>{a.value=!0},y=()=>{a.value=!1},x=k(""),V=async u=>{const f=u.target.files[0];if(x.value=f?f.name:"",!!f)try{const e=await U.uploadPhoto(l.token,f);return d.value={...d.value,photo:e.photoFilename,photoContentType:e.photoContentType,photoSize:e.photoSize,updatedAt:e.updatedAt},y(),{success:!0}}catch(e){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:",e),{success:!1,message:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ"}}};return j(()=>d.value.photo,async()=>{if(!d.value.photo){r.value="/tour-guide/img/user-default.jpg";return}try{const u=await U.getPhoto(l.token),f=atob(u.data),e=new Array(f.length);for(let g=0;g<f.length;g++)e[g]=f.charCodeAt(g);const M=new Uint8Array(e),D=new Blob([M],{type:u.contentType});r.value=URL.createObjectURL(D)}catch(u){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:",u),r.value="/tour-guide/img/user-default.jpg"}},{immediate:!0}),{isLoading:n,userData:d,avatarUrl:r,showAvatarPopup:a,activeTab:h,tabs:m,currentTabLabel:b,userStore:l,loadProfile:N,saveProfile:E,handleLogout:C,openModal:A,closeModal:y,onFileChange:V}}function oe(){const i=[44.943376,34.098043],l=()=>new Promise((r,a)=>{if(!navigator.geolocation){a(new Error("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º"));return}const h={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};navigator.geolocation.getCurrentPosition(m=>{r([m.coords.latitude,m.coords.longitude])},m=>{let b;switch(m.code){case m.PERMISSION_DENIED:b="–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º";break;case m.POSITION_UNAVAILABLE:b="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";break;case m.TIMEOUT:b="–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏—Å—Ç–µ–∫–ª–æ";break;default:b="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏"}a(new Error(b))},h)}),n=(r,a)=>{const h=`${r[1]},${r[0]}`,m=`${r[0]},${r[1]}~`+a.map(b=>`${b.coords[0]},${b.coords[1]}`).join("~");return`https://yandex.ru/maps/146/simferopol/?ll=${h}&mode=routes&rtext=${m}&rtt=mt&ruri=~~&z=13.6`};return{getUserCoords:l,getYandexRouteLink:n,openYandexRoute:async r=>{let a=i;try{a=await l()}catch(m){console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:",m.message),console.log("üîÑ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å):",a),alert(`–û—à–∏–±–∫–∞: ${m.message}. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ü–µ–Ω—Ç—Ä –°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—è.`)}const h=n(a,r.points);window.open(h,"_blank")}}}function se(){const i=I(),{openYandexRoute:l}=oe();return{openYandexRoute:l,deleteTrip:async d=>{try{return await U.deleteTrip(i.token,d),await i.fetchProfile(),{success:!0}}catch(r){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞:",r),{success:!1,message:r.message}}}}}const ne={key:0,class:"profile"},le={class:"profile-header"},ae={class:"profile-breadcrumbs"},re={class:"profile-wrapper"},ie={class:"profile-card"},de={class:"profile-sidebar"},ue={class:"sidebar-content"},ce={class:"avatar-block"},pe=["src"],me={class:"user-name"},fe={class:"user-username"},be={class:"user-meta"},he={key:0,class:"user-birth"},ve={class:"profile-nav"},ye=["onClick"],ge={key:0,class:"profile-content"},_e={class:"form-group"},we=["disabled"],ke={class:"form-group"},Te=["disabled"],Pe={class:"form-group"},Se=["disabled"],Ee={class:"form-group"},Ce=["disabled"],Ae={class:"form-group"},xe=["disabled"],De={class:"form-group"},Le=["disabled"],Ue={class:"form-group"},$e=["disabled"],Ne={key:1,class:"profile-content"},Ve={key:0,class:"trips-list"},Me={class:"trip-wrapper"},Oe={class:"trip-dates"},ze={class:"trip-points"},Re={key:0,class:"trip-notes"},Fe={class:"trip-buttons"},Ie=["onClick"],Be=["onClick"],je={key:1,class:"no-trips"},He={key:1,class:"profile loading"},Ye={class:"popup"},Je={class:"file-input-wrapper"},qe={class:"file-input-label"},Ge={key:0,class:"file-name"},We={class:"popup-actions"},Ze={__name:"ProfileView",setup(i){const{isLoading:l,userData:n,avatarUrl:d,showAvatarPopup:r,activeTab:a,tabs:h,currentTabLabel:m,userStore:b,loadProfile:N,saveProfile:E,handleLogout:C,openModal:A,closeModal:y,onFileChange:x}=te(),{openYandexRoute:V,deleteTrip:R}=se(),u=async f=>{if(console.log("–î–∞–Ω–Ω—ã–µ —Ç—É—Ä–∞:",f),!f.number){console.error("–£ —Ç—É—Ä–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–º–µ—Ä");return}const e=await R(f.number);e.success||console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞:",e.message)};return Y(N),(f,e)=>{var D,g;const M=X("selectedcontent");return p(),c(L,null,[o(l)&&o(b).isAuth?(p(),c("section",ne,[t("div",le,[e[13]||(e[13]=t("h1",null,"–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å",-1)),t("div",ae,"–ü—Ä–æ—Ñ–∏–ª—å / "+v(o(m)),1)]),t("div",re,[t("div",ie,[t("aside",de,[t("div",ue,[t("div",null,[t("div",ce,[t("img",{class:"avatar",src:o(d),alt:"avatar",onClick:e[0]||(e[0]=(...s)=>o(A)&&o(A)(...s)),style:J({"--auth-token":o(b).token})},null,12,pe),t("div",me,v(o(n).name)+" "+v(o(n).surname),1),t("div",fe,v(o(n).username),1),t("div",be,[o(n).birthDate?(p(),c("span",he,[e[14]||(e[14]=t("i",{class:"icon-calendar"},null,-1)),F(" "+v(o(n).birthDate),1)])):_("",!0)])]),t("nav",ve,[(p(!0),c(L,null,O(o(h),s=>(p(),c("button",{key:s.id,class:K(["nav-btn",{active:o(a)===s.id}]),onClick:P=>a.value=s.id},v(s.label),11,ye))),128))])]),t("button",{class:"logout-btn",onClick:e[1]||(e[1]=(...s)=>o(C)&&o(C)(...s))},"–í—ã–π—Ç–∏")])]),o(a)==="profile"||o(a)==="security"?(p(),c("div",ge,[t("h2",null,v(o(a)==="profile"?"–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è":"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"),1),t("div",_e,[e[15]||(e[15]=t("label",null,"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(n).username=s),type:"text",disabled:o(a)==="profile"},null,8,we),[[T,o(n).username]])]),t("div",ke,[e[16]||(e[16]=t("label",null,"–ü–æ—á—Ç–∞:",-1)),w(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o(n).email=s),type:"text",disabled:o(a)==="profile"},null,8,Te),[[T,o(n).email]])]),t("div",Pe,[e[17]||(e[17]=t("label",null,"–ò–º—è:",-1)),w(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(n).name=s),type:"text",disabled:o(a)==="profile"},null,8,Se),[[T,o(n).name]])]),t("div",Ee,[e[18]||(e[18]=t("label",null,"–§–∞–º–∏–ª–∏—è:",-1)),w(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o(n).surname=s),type:"text",disabled:o(a)==="profile"},null,8,Ce),[[T,o(n).surname]])]),t("div",Ae,[e[19]||(e[19]=t("label",null,"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",-1)),w(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o(n).phone=s),type:"text",disabled:o(a)==="profile"},null,8,xe),[[T,o(n).phone]])]),t("div",De,[e[21]||(e[21]=t("label",{for:"gender-select"},"–ü–æ–ª:",-1)),w(t("select",{id:"gender-select","onUpdate:modelValue":e[7]||(e[7]=s=>o(n).gender=s),disabled:o(a)==="profile"},[t("button",null,[W(M)]),e[20]||(e[20]=G('<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option><option value="male"><span class="option-label">–ú—É–∂—á–∏–Ω–∞</span></option><option value="female"><span class="option-label">–ñ–µ–Ω—â–∏–Ω–∞</span></option>',3))],8,Le),[[q,o(n).gender]])]),t("div",Ue,[e[22]||(e[22]=t("label",null,"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:",-1)),w(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o(n).birthday=s),type:"date",disabled:o(a)==="profile"},null,8,$e),[[T,o(n).birthday]])]),o(a)==="security"?(p(),c("button",{key:0,class:"save-btn",onClick:e[9]||(e[9]=(...s)=>o(E)&&o(E)(...s))}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ")):_("",!0)])):_("",!0),o(a)==="history"?(p(),c("div",Ne,[e[26]||(e[26]=t("h2",null,"–ú–æ–∏ —Ç—É—Ä—ã",-1)),(g=(D=o(b).user)==null?void 0:D.myTrips)!=null&&g.length?(p(),c("div",Ve,[(p(!0),c(L,null,O(o(b).user.myTrips,s=>(p(),c("div",{key:s.startDate+s.destination,class:"trip-card"},[t("div",Me,[t("h3",null,v(s.destination),1),t("div",Oe,[t("span",null,"–° "+v(new Date(s.startDate).toLocaleDateString()),1),t("span",null,"–ø–æ "+v(new Date(s.endDate).toLocaleDateString()),1)]),t("div",ze,[e[23]||(e[23]=t("b",null,"–¢–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞:",-1)),t("ul",null,[(p(!0),c(L,null,O(s.points,P=>(p(),c("li",{key:P.name},v(P.name),1))),128))])]),s.notes?(p(),c("div",Re,[e[24]||(e[24]=t("b",null,"–ó–∞–º–µ—Ç–∫–∏:",-1)),F(" "+v(s.notes),1)])):_("",!0)]),t("div",Fe,[t("button",{class:"build-route-btn",onClick:P=>o(V)(s)}," –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç ",8,Ie),t("button",{class:"delete-trip-btn",onClick:P=>u(s)},e[25]||(e[25]=[t("span",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",viewBox:"0 0 20 20",fill:"#000000"},[t("path",{fill:"#000000",d:"m6 2l2-2h4l2 2h4v2H2V2h4zM3 6h14l-1 14H4L3 6zm5 2v10h1V8H8zm3 0v10h1V8h-1z"})])],-1)]),8,Be)])]))),128))])):(p(),c("div",je,"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç—É—Ä–æ–≤"))])):_("",!0)])])])):(p(),c("div",He,"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...")),o(r)?(p(),c("div",{key:2,class:"popup-backdrop",onClick:e[12]||(e[12]=Z((...s)=>o(y)&&o(y)(...s),["self"]))},[t("div",Ye,[e[28]||(e[28]=t("h3",null,"–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ",-1)),t("div",Je,[t("label",qe,[e[27]||(e[27]=t("span",null,"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª",-1)),t("input",{type:"file",accept:"image/*",onChange:e[10]||(e[10]=(...s)=>o(x)&&o(x)(...s)),ref:"fileInput"},null,544)]),f.selectedFileName?(p(),c("span",Ge,v(f.selectedFileName),1)):_("",!0)]),t("div",We,[t("button",{class:"cancel-btn",onClick:e[11]||(e[11]=(...s)=>o(y)&&o(y)(...s))},"–û—Ç–º–µ–Ω–∞")])])])):_("",!0)],64)}}};export{Ze as default};
