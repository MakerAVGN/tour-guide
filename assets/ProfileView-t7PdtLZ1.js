import{u as I,r as S,l as H,w as Y,m as J,o as q,c as d,b as k,d as G,p as t,a as e,t as g,q as W,s as F,F as L,e as O,h as P,v as A,x as X,g as Z,j as c,k as K}from"./index-BtL-7-Lf.js";import{u as j,N as Q}from"./NotificationContainer-BB5IIq4R.js";const ee="https://tourgid-production.up.railway.app",z={POST:"POST",PUT:"PUT",DELETE:"DELETE"},oe={JSON:"application/json"},$=5*1024*1024,x=async(a,l={})=>{var p;const{token:u,...s}=l;if(s.body&&(s.body instanceof FormData?((p=s.body.get("photo"))==null?void 0:p.size)||0:JSON.stringify(s.body).length)>$)throw new Error(`–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π (${$/1024/1024}MB)`);const m=await fetch(`${ee}${a}`,{...s,headers:{...s.headers,...u&&{Authorization:`Bearer ${u}`}}});if(!m.ok){const r=await m.text();throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${m.status} - ${r}`)}return m.json()},U={async getProfile(a){return x("/profile",{token:a})},async updateProfile(a,l){console.log("profileService: –ù–∞—á–∞–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è");const u={username:l.username,email:l.email,name:l.name,surname:l.surname,phone:l.phone,gender:l.gender,birthday:l.birthday};console.log("profileService: –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",u);const s=await x("/profile",{method:z.PUT,headers:{"Content-Type":oe.JSON},body:JSON.stringify(u),token:a});return console.log("profileService: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",s),s},async uploadPhoto(a,l){if(l.size>$)throw new Error(`–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π (${$/1024/1024}MB)`);const u=new FormData;return u.append("photo",l),x("/profile/upload-photo",{method:z.POST,body:u,token:a})},async getPhoto(a){return x("/profile/photo",{token:a})},async deleteTrip(a,l){return x(`/profile/trips/${l}`,{method:z.DELETE,token:a})}};function te(){const a=J(),l=I(),u=S(!1),s=S({username:"",email:"",name:"",surname:"",phone:"",gender:"",birthday:"",photo:null}),m=S("/tour-guide/img/user-default.jpg"),p=S(!1),r=S("profile"),y=[{id:"profile",label:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ"},{id:"history",label:"–ú–æ–∏ —Ç—É—Ä—ã"},{id:"security",label:"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"}],h=H(()=>{const i=y.find(v=>v.id===r.value);return i?i.label:""}),f=async()=>{if(!l.isAuth){a.push("/");return}u.value=!1;try{await l.fetchProfile(),l.user&&(s.value={...l.user})}catch(i){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",i)}finally{u.value=!0}},M=async()=>{console.log("useProfile: –ù–∞—á–∞–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è");try{console.log("useProfile: –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:",s.value);const i=await U.updateProfile(l.token,s.value);return console.log("useProfile: –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",i),l.user=i,console.log("useProfile: –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"),{success:!0}}catch(i){return console.error("useProfile: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",i),{success:!1,error:i}}},V=()=>{l.logout(),a.push("/")},N=()=>{p.value=!0},E=()=>{p.value=!1},T=S(""),D=async i=>{const v=i.target.files[0];if(T.value=v?v.name:"",!!v)try{const w=await U.uploadPhoto(l.token,v);return s.value={...s.value,photo:w.photoFilename,photoContentType:w.photoContentType,photoSize:w.photoSize,updatedAt:w.updatedAt},E(),{success:!0}}catch(w){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:",w),{success:!1,message:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ"}}};return Y(()=>s.value.photo,async()=>{if(!s.value.photo){m.value="/tour-guide/img/user-default.jpg";return}try{const i=await U.getPhoto(l.token),v=atob(i.data),w=new Array(v.length);for(let _=0;_<v.length;_++)w[_]=v.charCodeAt(_);const b=new Uint8Array(w),o=new Blob([b],{type:i.contentType});m.value=URL.createObjectURL(o)}catch(i){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:",i),m.value="/tour-guide/img/user-default.jpg"}},{immediate:!0}),{isLoading:u,userData:s,avatarUrl:m,showAvatarPopup:p,activeTab:r,tabs:y,currentTabLabel:h,userStore:l,loadProfile:f,saveProfile:M,handleLogout:V,openModal:N,closeModal:E,onFileChange:D}}function se(){const a=[44.943376,34.098043],{showNotification:l}=j(),u=p=>new Promise((r,y)=>{if(!navigator.geolocation){l("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º","warning"),y(new Error("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º"));return}navigator.geolocation.getCurrentPosition(h=>{r([h.coords.latitude,h.coords.longitude])},h=>{let f;switch(h.code){case h.PERMISSION_DENIED:f="–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º";break;case h.POSITION_UNAVAILABLE:f="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";break;case h.TIMEOUT:f="–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏—Å—Ç–µ–∫–ª–æ";break;default:f="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏"}l(f,"warning"),y(new Error(f))},p)}),s=(p,r)=>{const y=`${p[1]},${p[0]}`,h=`${p[0]},${p[1]}~`+r.map(f=>`${f.coords[0]},${f.coords[1]}`).join("~");return`https://yandex.ru/maps/146/simferopol/?ll=${y}&mode=routes&rtext=${h}&rtt=mt&ruri=~~&z=13.6`};return{getUserCoords:u,getYandexRouteLink:s,openYandexRoute:async p=>{let r=a;try{r=await u({enableHighAccuracy:!0,timeout:5e3,maximumAge:0}),console.log("‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",r)}catch(h){l(`–û—à–∏–±–∫–∞: ${h.message}. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ü–µ–Ω—Ç—Ä –°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—è.`,"warning"),console.log("üîÑ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å):",r)}const y=s(r,p.points);window.open(y,"_blank")}}}function ne(){const a=I(),{openYandexRoute:l}=se();return{openYandexRoute:l,deleteTrip:async s=>{try{return await U.deleteTrip(a.token,s),await a.fetchProfile(),{success:!0}}catch(m){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞:",m),{success:!1,message:m.message}}}}}const le={key:0,class:"profile"},re={class:"profile-header"},ae={class:"profile-breadcrumbs"},ie={class:"profile-wrapper"},ue={class:"profile-card"},de={class:"profile-sidebar"},ce={class:"sidebar-content"},pe={class:"avatar-block"},fe=["src"],me={class:"user-name"},he={class:"user-username"},be={class:"user-meta"},ge={key:0,class:"user-birth"},ve={class:"profile-nav"},ye=["onClick"],we={key:0,class:"profile-content"},_e={class:"form-group"},ke=["disabled"],Pe={class:"form-group"},Te=["disabled"],Se={class:"form-group"},Ae=["disabled"],Ee={class:"form-group"},Ce=["disabled"],xe={class:"form-group"},Ne=["disabled"],De={class:"form-group"},Le=["disabled"],Ue={class:"form-group"},$e=["disabled"],Me={key:1,class:"profile-content"},Ve={key:0,class:"trips-list"},Oe={class:"trip-wrapper"},ze={class:"trip-dates"},Re={class:"trip-points"},Be={key:0,class:"trip-notes"},Fe={class:"trip-buttons"},Ie=["onClick"],je=["onClick"],He={key:1,class:"no-trips"},Ye={key:1,class:"profile loading"},Je={class:"popup"},qe={class:"file-input-wrapper"},Ge={class:"file-input-label"},We={key:0,class:"file-name"},Xe={class:"popup-actions"},Qe={__name:"ProfileView",props:{showAuth:{type:Boolean,required:!0}},emits:["openAuth","closeAuth"],setup(a){const{showNotification:l}=j(),{isLoading:u,userData:s,avatarUrl:m,showAvatarPopup:p,activeTab:r,tabs:y,currentTabLabel:h,userStore:f,loadProfile:M,saveProfile:V,handleLogout:N,openModal:E,closeModal:T,onFileChange:D}=te(),{openYandexRoute:R,deleteTrip:i}=ne(),v=async b=>{if(console.log("–î–∞–Ω–Ω—ã–µ —Ç—É—Ä–∞:",b),!b.number){console.error("–£ —Ç—É—Ä–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–º–µ—Ä");return}const o=await i(b.number);o.success||console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—É—Ä–∞:",o.message)};async function w(){console.log("–ù–∞—á–∞–ª–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è");try{const b=await V();console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:",b),b.success?(console.log("–ü–æ–∫–∞–∑—ã–≤–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ"),l("–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!","success")):(console.log("–ü–æ–∫–∞–∑—ã–≤–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"),l("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è","error"))}catch(b){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:",b),l("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è","error")}}return q(M),(b,o)=>{var _,B;return c(),d(L,null,[t(u)&&t(f).isAuth?(c(),d("section",le,[e("div",re,[o[12]||(o[12]=e("h1",null,"–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å",-1)),e("div",ae,"–ü—Ä–æ—Ñ–∏–ª—å / "+g(t(h)),1)]),e("div",ie,[e("div",ue,[e("aside",de,[e("div",ce,[e("div",null,[e("div",pe,[e("img",{class:"avatar",src:t(m),alt:"avatar",onClick:o[0]||(o[0]=(...n)=>t(E)&&t(E)(...n)),style:W({"--auth-token":t(f).token})},null,12,fe),e("div",me,g(t(s).name)+" "+g(t(s).surname),1),e("div",he,g(t(s).username),1),e("div",be,[t(s).birthDate?(c(),d("span",ge,[o[13]||(o[13]=e("i",{class:"icon-calendar"},null,-1)),F(" "+g(t(s).birthDate),1)])):k("",!0)])]),e("nav",ve,[(c(!0),d(L,null,O(t(y),n=>(c(),d("button",{key:n.id,class:K(["nav-btn",{active:t(r)===n.id}]),onClick:C=>r.value=n.id},g(n.label),11,ye))),128))])]),e("button",{class:"logout-btn",onClick:o[1]||(o[1]=(...n)=>t(N)&&t(N)(...n))},"–í—ã–π—Ç–∏")])]),t(r)==="profile"||t(r)==="security"?(c(),d("div",we,[e("h2",null,g(t(r)==="profile"?"–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è":"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"),1),e("div",_e,[o[14]||(o[14]=e("label",null,"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",-1)),P(e("input",{"onUpdate:modelValue":o[2]||(o[2]=n=>t(s).username=n),type:"text",disabled:t(r)==="profile"},null,8,ke),[[A,t(s).username]])]),e("div",Pe,[o[15]||(o[15]=e("label",null,"–ü–æ—á—Ç–∞:",-1)),P(e("input",{"onUpdate:modelValue":o[3]||(o[3]=n=>t(s).email=n),type:"text",disabled:t(r)==="profile"},null,8,Te),[[A,t(s).email]])]),e("div",Se,[o[16]||(o[16]=e("label",null,"–ò–º—è:",-1)),P(e("input",{"onUpdate:modelValue":o[4]||(o[4]=n=>t(s).name=n),type:"text",disabled:t(r)==="profile"},null,8,Ae),[[A,t(s).name]])]),e("div",Ee,[o[17]||(o[17]=e("label",null,"–§–∞–º–∏–ª–∏—è:",-1)),P(e("input",{"onUpdate:modelValue":o[5]||(o[5]=n=>t(s).surname=n),type:"text",disabled:t(r)==="profile"},null,8,Ce),[[A,t(s).surname]])]),e("div",xe,[o[18]||(o[18]=e("label",null,"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",-1)),P(e("input",{"onUpdate:modelValue":o[6]||(o[6]=n=>t(s).phone=n),type:"text",disabled:t(r)==="profile"},null,8,Ne),[[A,t(s).phone]])]),e("div",De,[o[20]||(o[20]=e("label",{for:"gender-select"},"–ü–æ–ª:",-1)),P(e("select",{id:"gender-select","onUpdate:modelValue":o[7]||(o[7]=n=>t(s).gender=n),disabled:t(r)==="profile"},o[19]||(o[19]=[e("option",{value:""},"–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª",-1),e("option",{value:"male"},"–ú—É–∂—á–∏–Ω–∞",-1),e("option",{value:"female"},"–ñ–µ–Ω—â–∏–Ω–∞",-1)]),8,Le),[[X,t(s).gender]])]),e("div",Ue,[o[21]||(o[21]=e("label",null,"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:",-1)),P(e("input",{"onUpdate:modelValue":o[8]||(o[8]=n=>t(s).birthday=n),type:"date",disabled:t(r)==="profile"},null,8,$e),[[A,t(s).birthday]])]),t(r)==="security"?(c(),d("button",{key:0,class:"save-btn",onClick:w}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ")):k("",!0)])):k("",!0),t(r)==="history"?(c(),d("div",Me,[o[25]||(o[25]=e("h2",null,"–ú–æ–∏ —Ç—É—Ä—ã",-1)),(B=(_=t(f).user)==null?void 0:_.myTrips)!=null&&B.length?(c(),d("div",Ve,[(c(!0),d(L,null,O(t(f).user.myTrips,n=>(c(),d("div",{key:n.startDate+n.destination,class:"trip-card"},[e("div",Oe,[e("h3",null,g(n.destination),1),e("div",ze,[e("span",null,"–° "+g(new Date(n.startDate).toLocaleDateString()),1),e("span",null,"–ø–æ "+g(new Date(n.endDate).toLocaleDateString()),1)]),e("div",Re,[o[22]||(o[22]=e("b",null,"–¢–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞:",-1)),e("ul",null,[(c(!0),d(L,null,O(n.points,C=>(c(),d("li",{key:C.name},g(C.name),1))),128))])]),n.notes?(c(),d("div",Be,[o[23]||(o[23]=e("b",null,"–ó–∞–º–µ—Ç–∫–∏:",-1)),F(" "+g(n.notes),1)])):k("",!0)]),e("div",Fe,[e("button",{class:"build-route-btn",onClick:C=>t(R)(n)}," –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç ",8,Ie),e("button",{class:"delete-trip-btn",onClick:C=>v(n)},o[24]||(o[24]=[e("span",null,[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",viewBox:"0 0 20 20",fill:"#000000"},[e("path",{fill:"#000000",d:"m6 2l2-2h4l2 2h4v2H2V2h4zM3 6h14l-1 14H4L3 6zm5 2v10h1V8H8zm3 0v10h1V8h-1z"})])],-1)]),8,je)])]))),128))])):(c(),d("div",He,"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç—É—Ä–æ–≤"))])):k("",!0)])])])):(c(),d("div",Ye,"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...")),t(p)?(c(),d("div",{key:2,class:"popup-backdrop",onClick:o[11]||(o[11]=Z((...n)=>t(T)&&t(T)(...n),["self"]))},[e("div",Je,[o[27]||(o[27]=e("h3",null,"–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ",-1)),e("div",qe,[e("label",Ge,[o[26]||(o[26]=e("span",null,"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª",-1)),e("input",{type:"file",accept:"image/*",onChange:o[9]||(o[9]=(...n)=>t(D)&&t(D)(...n)),ref:"fileInput"},null,544)]),b.selectedFileName?(c(),d("span",We,g(b.selectedFileName),1)):k("",!0)]),e("div",Xe,[e("button",{class:"cancel-btn",onClick:o[10]||(o[10]=(...n)=>t(T)&&t(T)(...n))},"–û—Ç–º–µ–Ω–∞")])])])):k("",!0),G(Q)],64)}}};export{Qe as default};
