import{u as R,r as w,k as z,w as F,l as B,_ as j,o as Y,c as i,b as _,m as o,a as t,t as b,p as H,q as V,F as U,d as M,g as k,v as P,s as J,e as q,x as G,y as W,f as X,i as d,j as Z}from"./index-Ba5XQKPw.js";const K="https://tourgid-production.up.railway.app",I={POST:"POST",PUT:"PUT"},Q={JSON:"application/json"},N=1024*1024,$=async(u,l={})=>{var a;const{token:n,...c}=l;if(c.body&&(c.body instanceof FormData?((a=c.body.get("photo"))==null?void 0:a.size)||0:JSON.stringify(c.body).length)>N)throw new Error(`–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π (${N/1024/1024}MB)`);const r=await fetch(`${K}${u}`,{...c,headers:{...c.headers,...n&&{Authorization:`Bearer ${n}`}}});if(!r.ok){const m=await r.text();throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${r.status} - ${m}`)}return r.json()},O={async getProfile(u){return $("/profile",{token:u})},async updateProfile(u,l){const n={username:l.username,email:l.email,name:l.name,surname:l.surname,phone:l.phone,gender:l.gender,birthday:l.birthday};return $("/profile",{method:I.PUT,headers:{"Content-Type":Q.JSON},body:JSON.stringify(n),token:u})},async uploadPhoto(u,l){if(l.size>N)throw new Error(`–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π (${N/1024/1024}MB)`);const n=new FormData;return n.append("photo",l),$("/profile/upload-photo",{method:I.POST,body:n,token:u})},async getPhoto(u){return $("/profile/photo",{token:u})}};function ee(){const u=B(),l=R(),n=w(!1),c=w({username:"",email:"",name:"",surname:"",phone:"",gender:"",birthday:"",photo:null}),r=w("/img/user-default.jpg"),a=w(!1),m=w("profile"),p=[{id:"profile",label:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ"},{id:"history",label:"–ú–æ–∏ —Ç—É—Ä—ã"},{id:"security",label:"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"}],f=z(()=>{const e=p.find(v=>v.id===m.value);return e?e.label:""}),D=async()=>{if(!l.isAuth){u.push("/");return}n.value=!1;try{await l.fetchProfile(),l.user&&(c.value={...l.user})}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",e)}finally{n.value=!0}},T=async()=>{try{const e=await O.updateProfile(l.token,c.value);return l.user=e,{success:!0,message:"–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!"}}catch(e){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",e),{success:!1,message:e.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è"}}},S=()=>{l.logout(),u.push("/")},A=()=>{a.value=!0},g=()=>{a.value=!1},C=w(""),L=async e=>{const v=e.target.files[0];if(C.value=v?v.name:"",!!v)try{const y=await O.uploadPhoto(l.token,v);return c.value={...c.value,photo:y.photoFilename,photoContentType:y.photoContentType,photoSize:y.photoSize,updatedAt:y.updatedAt},g(),{success:!0}}catch(y){return console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:",y),{success:!1,message:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ"}}};return F(()=>c.value.photo,async()=>{if(!c.value.photo){r.value="/img/user-default.jpg";return}try{const e=await O.getPhoto(l.token),v=atob(e.data),y=new Array(v.length);for(let h=0;h<v.length;h++)y[h]=v.charCodeAt(h);const x=new Uint8Array(y),s=new Blob([x],{type:e.contentType});r.value=URL.createObjectURL(s)}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:",e),r.value="/img/user-default.jpg"}},{immediate:!0}),{isLoading:n,userData:c,avatarUrl:r,showAvatarPopup:a,activeTab:m,tabs:p,currentTabLabel:f,userStore:l,loadProfile:D,saveProfile:T,handleLogout:S,openModal:A,closeModal:g,onFileChange:L}}function te(){const u=[44.943376,34.098043],l=()=>new Promise((r,a)=>{if(!navigator.geolocation){a(new Error("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º"));return}const m={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};navigator.geolocation.getCurrentPosition(p=>{r([p.coords.latitude,p.coords.longitude])},p=>{let f;switch(p.code){case p.PERMISSION_DENIED:f="–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º";break;case p.POSITION_UNAVAILABLE:f="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞";break;case p.TIMEOUT:f="–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏—Å—Ç–µ–∫–ª–æ";break;default:f="–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏"}a(new Error(f))},m)}),n=(r,a)=>{const m=`${r[1]},${r[0]}`,p=`${r[0]},${r[1]}~`+a.map(f=>`${f.coords[0]},${f.coords[1]}`).join("~");return`https://yandex.ru/maps/146/simferopol/?ll=${m}&mode=routes&rtext=${p}&rtt=mt&ruri=~~&z=13.6`};return{getUserCoords:l,getYandexRouteLink:n,openYandexRoute:async r=>{let a=u;try{a=await l()}catch(p){console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:",p.message),console.log("üîÑ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å):",a),alert(`–û—à–∏–±–∫–∞: ${p.message}. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ü–µ–Ω—Ç—Ä –°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—è.`)}const m=n(a,r.points);window.open(m,"_blank")}}}function oe(){const{openYandexRoute:u}=te();return{getTrips:n=>(n==null?void 0:n.myTrips)||[],openYandexRoute:u}}const se={key:0,class:"profile"},ne={class:"profile-header"},ae={class:"profile-breadcrumbs"},le={class:"profile-wrapper"},re={class:"profile-card"},ie={class:"profile-sidebar"},de={class:"sidebar-content"},ue={class:"avatar-block"},ce=["src"],pe={class:"user-name"},fe={class:"user-username"},me={class:"user-meta"},be={key:0,class:"user-birth"},ve={class:"profile-nav"},ye=["onClick"],he={key:0,class:"profile-content"},ge={class:"form-group"},_e=["disabled"],ke={class:"form-group"},we=["disabled"],Pe={class:"form-group"},Te=["disabled"],Se={class:"form-group"},Ae=["disabled"],Ce={class:"form-group"},xe=["disabled"],Ue={class:"form-group"},$e=["disabled"],Ne={class:"form-group"},De=["disabled"],Le={key:1,class:"profile-content"},Ee={key:0,class:"trips-list"},Me={class:"trip-wrapper"},Oe={class:"trip-dates"},Ve={class:"trip-points"},Ie={key:0,class:"trip-notes"},Re=["onClick"],ze={key:1,class:"no-trips"},Fe={key:1,class:"profile loading"},Be={class:"popup"},je={class:"file-input-wrapper"},Ye={class:"file-input-label"},He={key:0,class:"file-name"},Je={class:"popup-actions"},qe={__name:"ProfileView",setup(u){const{isLoading:l,userData:n,avatarUrl:c,showAvatarPopup:r,activeTab:a,tabs:m,currentTabLabel:p,userStore:f,loadProfile:D,saveProfile:T,handleLogout:S,openModal:A,closeModal:g,onFileChange:C}=ee(),{openYandexRoute:L}=oe();return Y(D),(E,e)=>{var y,x;const v=W("selectedcontent");return d(),i(U,null,[o(l)&&o(f).isAuth?(d(),i("section",se,[t("div",ne,[e[13]||(e[13]=t("h1",null,"–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å",-1)),t("div",ae,"–ü—Ä–æ—Ñ–∏–ª—å / "+b(o(p)),1)]),t("div",le,[t("div",re,[t("aside",ie,[t("div",de,[t("div",null,[t("div",ue,[t("img",{class:"avatar",src:o(c),alt:"avatar",onClick:e[0]||(e[0]=(...s)=>o(A)&&o(A)(...s)),style:H({"--auth-token":o(f).token})},null,12,ce),t("div",pe,b(o(n).name)+" "+b(o(n).surname),1),t("div",fe,b(o(n).username),1),t("div",me,[o(n).birthDate?(d(),i("span",be,[e[14]||(e[14]=t("i",{class:"icon-calendar"},null,-1)),V(" "+b(o(n).birthDate),1)])):_("",!0)])]),t("nav",ve,[(d(!0),i(U,null,M(o(m),s=>(d(),i("button",{key:s.id,class:Z(["nav-btn",{active:o(a)===s.id}]),onClick:h=>a.value=s.id},b(s.label),11,ye))),128))])]),t("button",{class:"logout-btn",onClick:e[1]||(e[1]=(...s)=>o(S)&&o(S)(...s))},"–í—ã–π—Ç–∏")])]),o(a)==="profile"||o(a)==="security"?(d(),i("div",he,[t("h2",null,b(o(a)==="profile"?"–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è":"–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"),1),t("div",ge,[e[15]||(e[15]=t("label",null,"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",-1)),k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o(n).username=s),type:"text",disabled:o(a)==="profile"},null,8,_e),[[P,o(n).username]])]),t("div",ke,[e[16]||(e[16]=t("label",null,"–ü–æ—á—Ç–∞:",-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o(n).email=s),type:"text",disabled:o(a)==="profile"},null,8,we),[[P,o(n).email]])]),t("div",Pe,[e[17]||(e[17]=t("label",null,"–ò–º—è:",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o(n).name=s),type:"text",disabled:o(a)==="profile"},null,8,Te),[[P,o(n).name]])]),t("div",Se,[e[18]||(e[18]=t("label",null,"–§–∞–º–∏–ª–∏—è:",-1)),k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o(n).surname=s),type:"text",disabled:o(a)==="profile"},null,8,Ae),[[P,o(n).surname]])]),t("div",Ce,[e[19]||(e[19]=t("label",null,"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",-1)),k(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o(n).phone=s),type:"text",disabled:o(a)==="profile"},null,8,xe),[[P,o(n).phone]])]),t("div",Ue,[e[21]||(e[21]=t("label",{for:"gender-select"},"–ü–æ–ª:",-1)),k(t("select",{id:"gender-select","onUpdate:modelValue":e[7]||(e[7]=s=>o(n).gender=s),disabled:o(a)==="profile"},[t("button",null,[G(v)]),e[20]||(e[20]=q('<option value="" data-v-f59cfc8e>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option><option value="male" data-v-f59cfc8e><span class="option-label" data-v-f59cfc8e>–ú—É–∂—á–∏–Ω–∞</span></option><option value="female" data-v-f59cfc8e><span class="option-label" data-v-f59cfc8e>–ñ–µ–Ω—â–∏–Ω–∞</span></option>',3))],8,$e),[[J,o(n).gender]])]),t("div",Ne,[e[22]||(e[22]=t("label",null,"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:",-1)),k(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o(n).birthday=s),type:"date",disabled:o(a)==="profile"},null,8,De),[[P,o(n).birthday]])]),o(a)==="security"?(d(),i("button",{key:0,class:"save-btn",onClick:e[9]||(e[9]=(...s)=>o(T)&&o(T)(...s))}," –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ")):_("",!0)])):_("",!0),o(a)==="history"?(d(),i("div",Le,[e[25]||(e[25]=t("h2",null,"–ú–æ–∏ —Ç—É—Ä—ã",-1)),(x=(y=o(f).user)==null?void 0:y.myTrips)!=null&&x.length?(d(),i("div",Ee,[(d(!0),i(U,null,M(o(f).user.myTrips,s=>(d(),i("div",{key:s.startDate+s.destination,class:"trip-card"},[t("div",Me,[t("h3",null,b(s.destination),1),t("div",Oe,[t("span",null,"–° "+b(new Date(s.startDate).toLocaleDateString()),1),t("span",null,"–ø–æ "+b(new Date(s.endDate).toLocaleDateString()),1)]),t("div",Ve,[e[23]||(e[23]=t("b",null,"–¢–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞:",-1)),t("ul",null,[(d(!0),i(U,null,M(s.points,h=>(d(),i("li",{key:h.name},b(h.name),1))),128))])]),s.notes?(d(),i("div",Ie,[e[24]||(e[24]=t("b",null,"–ó–∞–º–µ—Ç–∫–∏:",-1)),V(" "+b(s.notes),1)])):_("",!0)]),t("button",{class:"build-route-btn",onClick:h=>o(L)(s)}," –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç ",8,Re)]))),128))])):(d(),i("div",ze,"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç—É—Ä–æ–≤"))])):_("",!0)])])])):(d(),i("div",Fe,"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...")),o(r)?(d(),i("div",{key:2,class:"popup-backdrop",onClick:e[12]||(e[12]=X((...s)=>o(g)&&o(g)(...s),["self"]))},[t("div",Be,[e[27]||(e[27]=t("h3",null,"–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ",-1)),t("div",je,[t("label",Ye,[e[26]||(e[26]=t("span",null,"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª",-1)),t("input",{type:"file",accept:"image/*",onChange:e[10]||(e[10]=(...s)=>o(C)&&o(C)(...s)),ref:"fileInput"},null,544)]),E.selectedFileName?(d(),i("span",He,b(E.selectedFileName),1)):_("",!0)]),t("div",Je,[t("button",{class:"cancel-btn",onClick:e[11]||(e[11]=(...s)=>o(g)&&o(g)(...s))},"–û—Ç–º–µ–Ω–∞")])])])):_("",!0)],64)}}},We=j(qe,[["__scopeId","data-v-f59cfc8e"]]);export{We as default};
